<VirtualHost *:443>

ServerName ${SERVER_NAME}:443
ErrorLog /proc/self/fd/2
TransferLog /proc/self/fd/1

SSLEngine on

SSLCertificateFile "/usr/local/apache2/ssl/fhir_certificate.pem"
SSLCertificateKeyFile "/usr/local/apache2/ssl/fhir_private-key.pem"
SSLCertificateChainFile "/usr/local/apache2/ssl/testca_certificate.pem"
SSLCACertificateFile "/usr/local/apache2/ssl/testca_certificate.pem"

SSLVerifyClient require
#SSLVerifyDepth  10

SSLOptions +ExportCertData

SSLVerifyClient require
SSLOptions +ExportCertData

RequestHeader set X-ClientCert ""

Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"

<Location "/fhir">
	RequestHeader set X-ClientCert %{SSL_CLIENT_CERT}s

	ProxyPass http://172.28.1.3:8080/fhir
	ProxyPassReverse http://172.28.1.3:8080/fhir
</Location>
<Location "/fhir/ws">
	RequestHeader set X-ClientCert %{SSL_CLIENT_CERT}s

	ProxyPass ws://172.28.1.3:8080/fhir/ws
	ProxyPassReverse ws://172.28.1.3:8080/fhir/ws
</Location>

BrowserMatch "MSIE [2-5]" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0

CustomLog /proc/self/fd/1 \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

</VirtualHost>